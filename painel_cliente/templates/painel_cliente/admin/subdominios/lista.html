{% extends 'painel_cliente/admin/base_admin.html' %}

{% block title %}Subdomínios{% endblock %}
{% block breadcrumb %}Subdomínios{% endblock %}

{% block content %}
<div class="animate-fade-in-up">
  <!-- Page Header -->
  <div class="page-header-admin">
    <h1>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="2" y1="12" x2="22" y2="12"></line>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
      </svg>
      Gestão de Subdomínios
    </h1>
    <a href="{% url 'painel_cliente:admin_subdominio_criar' %}" class="btn btn-primary">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="16"></line>
        <line x1="8" y1="12" x2="16" y2="12"></line>
      </svg>
      Novo Subdomínio
    </a>
  </div>

  <!-- Subdominios Table -->
  <div class="admin-card">
    <div class="admin-card-body-flush">
      <div class="table-responsive">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Subdomínio</th>
              <th>Nome de Exibição</th>
              <th>Admin Responsável</th>
              <th>Status</th>
              <th>Criado em</th>
              <th style="text-align: right;">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for sub in subdominios %}
            <tr class="animate-fade-in-up" style="animation-delay: {{ forloop.counter0 }}00ms;">
              <td>
                <a href="https://{{ sub.dominio_completo }}" target="_blank" class="subdominio-link">
                  <span class="subdominio-name">{{ sub.subdominio }}</span>
                  <span class="subdominio-suffix">.pagar.cc</span>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </a>
              </td>
              <td>
                <span class="text-primary">{{ sub.nome_exibicao }}</span>
              </td>
              <td>
                <div class="admin-user-cell">
                  <div class="admin-user-avatar">
                    {{ sub.admin_responsavel.username|slice:":1"|upper }}
                  </div>
                  <div class="admin-user-info">
                    <span class="admin-user-name">{{ sub.admin_responsavel.username }}</span>
                    {% if sub.admin_responsavel.email %}
                    <span class="admin-user-email">{{ sub.admin_responsavel.email }}</span>
                    {% endif %}
                  </div>
                </div>
              </td>
              <td>
                {% if sub.ativo %}
                <span class="badge badge-success">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  Ativo
                </span>
                {% else %}
                <span class="badge badge-neutral">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                  Inativo
                </span>
                {% endif %}
              </td>
              <td>
                <div class="table-date">
                  <span class="table-date-value">{{ sub.criado_em|date:"d/m/Y" }}</span>
                  {% if sub.criado_por %}
                  <span class="table-date-by">por {{ sub.criado_por.username }}</span>
                  {% endif %}
                </div>
              </td>
              <td style="text-align: right;">
                <div class="action-buttons">
                  <a href="{% url 'painel_cliente:admin_subdominio_editar' sub.pk %}" class="btn btn-icon btn-ghost" title="Editar">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </a>
                  <button type="button" class="btn btn-icon btn-ghost btn-danger" title="Excluir" onclick="confirmarExclusao({{ sub.pk }}, '{{ sub.subdominio }}')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6">
                <div class="admin-empty">
                  <div class="admin-empty-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="2" y1="12" x2="22" y2="12"></line>
                      <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                  </div>
                  <h3 class="admin-empty-title">Nenhum subdomínio cadastrado</h3>
                  <p class="admin-empty-text">Crie seu primeiro subdomínio para começar</p>
                  <a href="{% url 'painel_cliente:admin_subdominio_criar' %}" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="16"></line>
                      <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                    Criar Primeiro Subdomínio
                  </a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal-overlay" id="modal-excluir">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-icon modal-icon-danger">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </div>
      <h3 class="modal-title">Confirmar Exclusão</h3>
      <button type="button" class="modal-close" onclick="fecharModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <p>Tem certeza que deseja excluir o subdomínio <strong id="subdominio-nome"></strong>?</p>
      <p class="modal-warning">Esta ação não pode ser desfeita.</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-ghost" onclick="fecharModal()">Cancelar</button>
      <form id="form-excluir" method="post" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Excluir
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .subdominio-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    color: var(--color-text-primary);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .subdominio-link:hover {
    color: var(--color-primary);
  }

  .subdominio-name {
    font-weight: var(--font-semibold);
  }

  .subdominio-suffix {
    color: var(--color-text-muted);
  }

  .subdominio-link svg {
    color: var(--color-text-muted);
    opacity: 0;
    transition: opacity var(--transition-fast);
  }

  .subdominio-link:hover svg {
    opacity: 1;
  }

  .admin-user-cell {
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .admin-user-avatar {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-full);
    background: var(--gradient-primary);
    color: white;
    font-weight: var(--font-bold);
    font-size: var(--text-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .admin-user-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
  }

  .admin-user-name {
    font-weight: var(--font-medium);
    color: var(--color-text-primary);
  }

  .admin-user-email {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .table-date {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .table-date-value {
    font-weight: var(--font-medium);
  }

  .table-date-by {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }

  .action-buttons {
    display: flex;
    gap: var(--space-1);
    justify-content: flex-end;
  }

  .btn-icon {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-lg);
  }

  .btn-danger {
    background: var(--color-danger);
    color: white;
    border: none;
  }

  .btn-danger:hover {
    background: #dc2626;
  }

  .btn-ghost.btn-danger {
    background: transparent;
    color: var(--color-danger);
  }

  .btn-ghost.btn-danger:hover {
    background: rgba(239, 68, 68, 0.1);
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
    z-index: var(--z-modal);
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-normal);
  }

  .modal-overlay.is-visible {
    opacity: 1;
    visibility: visible;
  }

  .modal {
    background: var(--color-surface);
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-xl);
    width: 100%;
    max-width: 420px;
    transform: scale(0.9) translateY(20px);
    transition: transform var(--transition-normal);
  }

  .modal-overlay.is-visible .modal {
    transform: scale(1) translateY(0);
  }

  .modal-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-6) var(--space-6) var(--space-4);
    position: relative;
  }

  .modal-close {
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
    width: 32px;
    height: 32px;
    border-radius: var(--radius-lg);
    background: transparent;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
  }

  .modal-close:hover {
    background: var(--color-surface-hover);
    color: var(--color-text-primary);
  }

  .modal-icon {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-icon-danger {
    background: rgba(239, 68, 68, 0.1);
    color: var(--color-danger);
  }

  .modal-title {
    font-size: var(--text-lg);
    font-weight: var(--font-bold);
    color: var(--color-text-primary);
    margin: 0;
  }

  .modal-body {
    padding: 0 var(--space-6);
    text-align: center;
  }

  .modal-body p {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    margin: 0 0 var(--space-2) 0;
  }

  .modal-body strong {
    color: var(--color-text-primary);
  }

  .modal-warning {
    font-size: var(--text-xs) !important;
    color: var(--color-text-muted) !important;
  }

  .modal-footer {
    display: flex;
    gap: var(--space-3);
    justify-content: center;
    padding: var(--space-5) var(--space-6) var(--space-6);
  }

  .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  const modalOverlay = document.getElementById('modal-excluir');

  function confirmarExclusao(pk, nome) {
    document.getElementById('subdominio-nome').textContent = nome + '.pagar.cc';
    document.getElementById('form-excluir').action = '/painel-admin/subdominios/' + pk + '/excluir/';
    modalOverlay.classList.add('is-visible');
    document.body.style.overflow = 'hidden';
  }

  function fecharModal() {
    modalOverlay.classList.remove('is-visible');
    document.body.style.overflow = '';
  }

  // Close on overlay click
  modalOverlay.addEventListener('click', function(e) {
    if (e.target === modalOverlay) {
      fecharModal();
    }
  });

  // Close on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modalOverlay.classList.contains('is-visible')) {
      fecharModal();
    }
  });
</script>
{% endblock %}
