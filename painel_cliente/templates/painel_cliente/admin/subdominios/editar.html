{% extends 'painel_cliente/admin/base_admin.html' %}

{% block title %}Editar Subdomínio{% endblock %}
{% block breadcrumb %}Editar Subdomínio{% endblock %}

{% block content %}
<div class="animate-fade-in-up">
  <!-- Page Header -->
  <div class="page-header-admin">
    <div class="page-header-back">
      <a href="{% url 'painel_cliente:admin_subdominios' %}" class="btn btn-icon btn-ghost">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
      </a>
      <div>
        <h1>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Editar Subdomínio
        </h1>
        <p class="page-header-subtitle">{{ subdominio_obj.subdominio }}.pagar.cc</p>
      </div>
    </div>
  </div>

  <!-- Form Card -->
  <div class="admin-card">
    <div class="admin-card-body">
      <form method="post" action="{% url 'painel_cliente:admin_subdominio_editar' subdominio_obj.pk %}" class="admin-form" id="form-editar">
        {% csrf_token %}

        <div class="form-grid">
          <!-- Subdominio (readonly) -->
          <div class="form-group">
            <label class="form-label">Subdomínio</label>
            <div class="input-group">
              <input
                type="text"
                class="form-input form-input-disabled"
                value="{{ subdominio_obj.subdominio }}"
                disabled
                readonly
              >
              <span class="input-group-text">.pagar.cc</span>
            </div>
            <p class="form-hint">O subdomínio não pode ser alterado</p>
          </div>

          <!-- Nome de Exibicao -->
          <div class="form-group">
            <label for="nome_exibicao" class="form-label">
              Nome de Exibição
              <span class="form-required">*</span>
            </label>
            <input
              type="text"
              class="form-input"
              id="nome_exibicao"
              name="nome_exibicao"
              value="{{ subdominio_obj.nome_exibicao }}"
              required
            >
          </div>

          <!-- Admin Responsavel -->
          <div class="form-group">
            <label for="admin_responsavel" class="form-label">
              Admin Responsável
              <span class="form-required">*</span>
            </label>
            <div class="select-wrapper">
              <select class="form-select" id="admin_responsavel" name="admin_responsavel" required>
                {% for usuario in usuarios %}
                <option value="{{ usuario.id }}" {% if subdominio_obj.admin_responsavel.id == usuario.id %}selected{% endif %}>
                  {{ usuario.username }}{% if usuario.email %} ({{ usuario.email }}){% endif %}
                </option>
                {% endfor %}
              </select>
              <svg class="select-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </div>

          <!-- Conta FastDePix -->
          <div class="form-group">
            <label for="conta_bancaria" class="form-label">Conta FastDePix</label>
            <div class="select-wrapper">
              <select class="form-select" id="conta_bancaria" name="conta_bancaria">
                <option value="">Nenhuma</option>
                {% for conta in contas_fastdepix %}
                <option value="{{ conta.id }}" {% if subdominio_obj.conta_bancaria and subdominio_obj.conta_bancaria.id == conta.id %}selected{% endif %}>
                  {{ conta.apelido|default:conta.beneficiario }}
                </option>
                {% endfor %}
              </select>
              <svg class="select-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </div>
          </div>
        </div>

        <!-- Status Toggle -->
        <div class="form-group">
          <label class="toggle-wrapper">
            <input
              type="checkbox"
              id="ativo"
              name="ativo"
              class="toggle-input"
              {% if subdominio_obj.ativo %}checked{% endif %}
            >
            <span class="toggle-switch"></span>
            <span class="toggle-label">Subdomínio ativo</span>
          </label>
        </div>

        <hr class="form-divider">

        <!-- Meta Info -->
        <div class="meta-info">
          <div class="meta-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>Criado em {{ subdominio_obj.criado_em|date:"d/m/Y H:i" }}{% if subdominio_obj.criado_por %} por {{ subdominio_obj.criado_por.username }}{% endif %}</span>
          </div>
          <div class="meta-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>Atualizado em {{ subdominio_obj.atualizado_em|date:"d/m/Y H:i" }}</span>
          </div>
        </div>

        <hr class="form-divider">

        <!-- Actions -->
        <div class="form-actions">
          <a href="{% url 'painel_cliente:admin_subdominios' %}" class="btn btn-ghost">Cancelar</a>
          <button type="submit" class="btn btn-primary" id="btn-salvar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Salvar Alterações
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .page-header-back {
    display: flex;
    align-items: flex-start;
    gap: var(--space-3);
  }

  .page-header-subtitle {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin: var(--space-1) 0 0 calc(28px + var(--space-3));
  }

  .admin-form {
    max-width: 800px;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-5);
    margin-bottom: var(--space-5);
  }

  @media (max-width: 640px) {
    .form-grid {
      grid-template-columns: 1fr;
    }
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .form-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-text-primary);
    display: flex;
    align-items: center;
    gap: var(--space-1);
  }

  .form-required {
    color: var(--color-danger);
  }

  .form-input,
  .form-select {
    width: 100%;
    padding: var(--space-3) var(--space-4);
    font-size: var(--text-sm);
    color: var(--color-text-primary);
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    transition: all var(--transition-fast);
  }

  .form-input:focus,
  .form-select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
  }

  .form-input-disabled {
    background: var(--color-surface-elevated);
    color: var(--color-text-muted);
    cursor: not-allowed;
  }

  .input-group {
    display: flex;
  }

  .input-group .form-input {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }

  .input-group-text {
    display: flex;
    align-items: center;
    padding: 0 var(--space-4);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    background: var(--color-surface-elevated);
    border: 1px solid var(--color-border);
    border-left: none;
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
  }

  .select-wrapper {
    position: relative;
  }

  .form-select {
    appearance: none;
    padding-right: var(--space-10);
  }

  .select-icon {
    position: absolute;
    right: var(--space-4);
    top: 50%;
    transform: translateY(-50%);
    color: var(--color-text-muted);
    pointer-events: none;
  }

  .form-hint {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    margin: 0;
  }

  /* Toggle */
  .toggle-wrapper {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    cursor: pointer;
  }

  .toggle-input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .toggle-switch {
    width: 44px;
    height: 24px;
    background: var(--color-border);
    border-radius: var(--radius-full);
    position: relative;
    transition: background var(--transition-fast);
    flex-shrink: 0;
  }

  .toggle-switch::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-sm);
    transition: transform var(--transition-fast);
  }

  .toggle-input:checked + .toggle-switch {
    background: var(--color-success);
  }

  .toggle-input:checked + .toggle-switch::after {
    transform: translateX(20px);
  }

  .toggle-label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-text-primary);
  }

  .form-divider {
    border: none;
    border-top: 1px solid var(--color-border-light);
    margin: var(--space-6) 0;
  }

  .meta-info {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-5);
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  .meta-item svg {
    flex-shrink: 0;
  }

  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-3);
  }

  [data-theme="dark"] .form-input,
  [data-theme="dark"] .form-select {
    background: var(--color-surface-elevated);
  }

  [data-theme="dark"] .form-input-disabled {
    background: var(--color-surface);
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('form-editar');
    const btnSalvar = document.getElementById('btn-salvar');

    form.addEventListener('submit', function() {
      btnSalvar.disabled = true;
      btnSalvar.innerHTML = '<span class="spinner spinner-sm"></span> Salvando...';
    });
  });
</script>
{% endblock %}
