<style>
  .notif-modal-section {
    margin-bottom: 24px;
  }
  .notif-modal-section:last-child {
    margin-bottom: 0;
  }
  .notif-section-header {
    display: flex;
    align-items: center;
    padding: 8px 0;
    margin-bottom: 12px;
    border-bottom: 1px solid #e9ecef;
  }
  .notif-section-title {
    font-size: 13px;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .notif-section-count {
    font-size: 12px;
    color: #adb5bd;
    margin-left: 8px;
  }
  .notif-modal-item {
    display: flex;
    align-items: flex-start;
    padding: 14px 16px;
    border-radius: 8px;
    margin-bottom: 8px;
    background-color: #f8f9fa;
    border-left: 3px solid #6c757d;
    transition: all 0.15s ease;
  }
  .notif-modal-item:hover {
    background-color: #f1f3f5;
  }
  .notif-modal-item.item-pagamento {
    border-left-color: #198754;
  }
  .notif-modal-item.item-alerta {
    border-left-color: #ffc107;
  }
  .notif-modal-item.item-critico {
    border-left-color: #dc3545;
  }
  .notif-modal-item.item-plano {
    border-left-color: #0d6efd;
  }
  .notif-modal-item.item-vencida {
    border-left-color: #dc3545;
  }
  .notif-modal-item.item-lida {
    opacity: 0.6;
    border-left-color: #adb5bd;
  }
  .notif-modal-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-right: 14px;
  }
  .notif-modal-icon.icon-pagamento {
    background-color: rgba(25, 135, 84, 0.1);
    color: #198754;
  }
  .notif-modal-icon.icon-alerta {
    background-color: rgba(255, 193, 7, 0.15);
    color: #cc9a00;
  }
  .notif-modal-icon.icon-critico {
    background-color: rgba(220, 53, 69, 0.1);
    color: #dc3545;
  }
  .notif-modal-icon.icon-plano {
    background-color: rgba(13, 110, 253, 0.1);
    color: #0d6efd;
  }
  .notif-modal-icon.icon-info {
    background-color: rgba(108, 117, 125, 0.1);
    color: #6c757d;
  }
  .notif-modal-icon.icon-vencida {
    background-color: rgba(220, 53, 69, 0.1);
    color: #dc3545;
  }
  .notif-modal-content {
    flex: 1;
    min-width: 0;
  }
  .notif-modal-title {
    font-size: 14px;
    font-weight: 600;
    color: #212529;
    margin-bottom: 4px;
    line-height: 1.3;
  }
  .notif-modal-message {
    font-size: 13px;
    color: #6c757d;
    margin-bottom: 6px;
    line-height: 1.45;
  }
  .notif-modal-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }
  .notif-modal-time {
    font-size: 12px;
    color: #adb5bd;
  }
  .notif-modal-badge {
    font-size: 11px;
    padding: 2px 8px;
    border-radius: 12px;
    font-weight: 500;
  }
  .notif-modal-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 12px;
  }
  .notif-modal-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: #fff;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.15s ease;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }
  .notif-modal-btn:hover {
    background-color: #e9ecef;
    color: #495057;
  }
  .notif-modal-btn.btn-danger:hover {
    background-color: #dc3545;
    color: #fff;
  }
  .notif-modal-empty {
    text-align: center;
    padding: 48px 24px;
    color: #adb5bd;
  }
  .notif-modal-empty svg {
    width: 64px;
    height: 64px;
    margin-bottom: 16px;
    opacity: 0.4;
  }
  .notif-modal-empty-title {
    font-size: 16px;
    font-weight: 500;
    color: #6c757d;
    margin-bottom: 4px;
  }
  .notif-modal-empty-text {
    font-size: 13px;
    color: #adb5bd;
  }
</style>

{% if notificacoes_sistema %}
<div class="notif-modal-section">
  <div class="notif-section-header">
    <span class="notif-section-title">Notificacoes do Sistema</span>
    <span class="notif-section-count">({{ notificacoes_sistema|length }})</span>
  </div>

  {% for n in notificacoes_sistema %}
  <div class="notif-modal-item {% if n.tipo == 'pagamento_confirmado' %}item-pagamento{% elif n.prioridade == 'critica' %}item-critico{% elif n.prioridade == 'alta' %}item-alerta{% elif n.tipo == 'mudanca_plano' %}item-plano{% endif %}" data-notif-id="{{ n.id }}">

    <div class="notif-modal-icon {% if n.tipo == 'pagamento_confirmado' %}icon-pagamento{% elif n.prioridade == 'critica' %}icon-critico{% elif n.prioridade == 'alta' %}icon-alerta{% elif n.tipo == 'mudanca_plano' %}icon-plano{% else %}icon-info{% endif %}">
      {% if n.tipo == 'pagamento_confirmado' %}
        <i data-feather="check-circle" style="width: 20px; height: 20px;"></i>
      {% elif n.prioridade == 'critica' %}
        <i data-feather="alert-octagon" style="width: 20px; height: 20px;"></i>
      {% elif n.prioridade == 'alta' %}
        <i data-feather="alert-triangle" style="width: 20px; height: 20px;"></i>
      {% elif n.tipo == 'mudanca_plano' %}
        <i data-feather="refresh-cw" style="width: 20px; height: 20px;"></i>
      {% else %}
        <i data-feather="info" style="width: 20px; height: 20px;"></i>
      {% endif %}
    </div>

    <div class="notif-modal-content">
      <div class="notif-modal-title">{{ n.titulo }}</div>
      <div class="notif-modal-message">{{ n.mensagem }}</div>
      <div class="notif-modal-meta">
        <span class="notif-modal-time">{{ n.criada_em|timesince }} atras</span>
        {% if n.tipo == 'pagamento_confirmado' %}
          <span class="notif-modal-badge" style="background-color: rgba(25,135,84,0.1); color: #198754;">Pagamento</span>
        {% elif n.prioridade == 'critica' %}
          <span class="notif-modal-badge" style="background-color: rgba(220,53,69,0.1); color: #dc3545;">Critico</span>
        {% elif n.prioridade == 'alta' %}
          <span class="notif-modal-badge" style="background-color: rgba(255,193,7,0.15); color: #cc9a00;">Alerta</span>
        {% elif n.tipo == 'mudanca_plano' %}
          <span class="notif-modal-badge" style="background-color: rgba(13,110,253,0.1); color: #0d6efd;">Plano</span>
        {% endif %}
      </div>
    </div>

    <div class="notif-modal-actions">
      <button type="button" class="notif-modal-btn btn-marcar-lida-modal" data-notif-id="{{ n.id }}" title="Marcar como lida">
        <i data-feather="check" style="width: 16px; height: 16px;"></i>
      </button>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

{% if mensalidades %}
<div class="notif-modal-section">
  <div class="notif-section-header">
    <span class="notif-section-title">Mensalidades Vencidas</span>
    <span class="notif-section-count">({{ mensalidades|length }}{% if is_paginated %} de {{ page_obj.paginator.count }}{% endif %})</span>
  </div>

  {% for m in mensalidades %}
  <div class="notif-modal-item item-vencida {% if m.ja_lida %}item-lida{% endif %}">
    <div class="notif-modal-icon icon-vencida">
      <i data-feather="alert-circle" style="width: 20px; height: 20px;"></i>
    </div>

    <div class="notif-modal-content">
      <div class="notif-modal-title">{{ m.cliente.nome }}</div>
      <div class="notif-modal-message">
        Mensalidade vencida em {{ m.dt_vencimento|date:"d/m/Y" }}.
        Plano: {{ m.cliente.plano.nome }}. Valor: R$ {{ m.valor }}
      </div>
      <div class="notif-modal-meta">
        <span class="notif-modal-time" style="color: #dc3545;">{{ m.dias_atraso.days }} dias em atraso</span>
        <span class="notif-modal-badge" style="background-color: {% if m.cliente.forma_pgto.nome == 'Cartão de Crédito' %}rgba(13,110,253,0.1); color: #0d6efd;{% else %}rgba(255,193,7,0.15); color: #cc9a00;{% endif %}">
          {{ m.cliente.forma_pgto.nome }}
        </span>
        {% if m.ja_lida %}
          <span class="notif-modal-badge" style="background-color: rgba(108,117,125,0.1); color: #6c757d;">Lida</span>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% if is_paginated %}
<nav class="mt-3">
  <ul class="pagination pagination-sm justify-content-center mb-0">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link js-notif-page" href="?page={{ page_obj.previous_page_number }}">
          <i data-feather="chevron-left" style="width: 14px; height: 14px;"></i>
        </a>
      </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link">Pagina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
    </li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link js-notif-page" href="?page={{ page_obj.next_page_number }}">
          <i data-feather="chevron-right" style="width: 14px; height: 14px;"></i>
        </a>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endif %}

{% if not mensalidades and not notificacoes_sistema %}
<div class="notif-modal-empty">
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  <div class="notif-modal-empty-title">Nenhuma notificacao pendente</div>
  <div class="notif-modal-empty-text">Voce esta em dia com todas as notificacoes</div>
</div>
{% endif %}

