{% load static %}
{% load crispy_forms_tags %}

<!DOCTYPE html>
<html lang="pt-br">

<head>
  {% include 'partials/head.html' %}
  <title>Login | Nosso Painel</title>
</head>

<body class="bg-light">
  <!-- container -->
  <div class="container d-flex flex-column">
    <div class="row align-items-center justify-content-center g-0
        min-vh-100">
      <div class="col-12 col-md-8 col-lg-6 col-xxl-4 py-8 py-xl-0">
        <!-- Card -->
        <div class="card smooth-shadow-md">
          <!-- Card body -->
          <div class="card-body p-6">
            <div class="mb-4">
              <img src="{% static '/assets/images/svg/logo-brand-login.svg' %}" alt="Logo" class="img-fluid">
              <p class="fs-3"></p>
            </div>
            <!-- Form -->
            <form method="POST" action="" id="loginForm">
              {% csrf_token %}

              <!-- Exibir erros gerais do formulário (credenciais incorretas) -->
              {% if form.non_field_errors %}
              <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-x-circle me-2"></i>
                {% for error in form.non_field_errors %}
                  <span>{{ error }}</span>
                {% endfor %}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
              </div>
              {% endif %}

              <!-- Exibir erro específico do captcha -->
              {% if form.captcha.errors %}
              <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>
                {% for error in form.captcha.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
              </div>
              {% endif %}

              <!-- Campo Usuário -->
              <div class="mb-3">
                <label for="id_username" class="form-label">Usuário</label>
                <input type="text" name="username" class="form-control form-control-lg" id="id_username" placeholder="Digite seu usuário" required autofocus>
              </div>

              <!-- Campo Senha -->
              <div class="mb-3">
                <label for="id_password" class="form-label">Senha</label>
                <input type="password" name="password" class="form-control form-control-lg" id="id_password" placeholder="Digite sua senha" required>
              </div>

              <!-- reCAPTCHA -->
              <div class="mb-3">
                {{ form.captcha }}
              </div>
              <div>
                <!-- Button -->
                <div class="d-grid">
                  <button id="loginButton" type="submit" class="btn btn-primary">Entrar</button>
                </div>
                  <p></p>
                  <div class="d-flex justify-content-center">
                    <a href="#" class="text-inherit fs-5">Esqueceu a senha senha?</a>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Scripts -->
  {% include 'partials/scripts.html' %}
</body>
</html>

<style>
  .g-recaptcha {
      margin: 0 auto; /* Define margens automáticas para centralizar horizontalmente */
      display: flex; /* Define o elemento como bloco para que as margens automáticas funcionem */
      justify-content: center; /* Centraliza o conteúdo dentro do elemento */
      margin-top: 25px;
      margin-bottom: 25px;
      border: none !important;
      box-shadow: none !important;
  }

  /* Ocultar label do captcha */
  label[for="id_captcha"] {
    display: none;
  }

  /* Botão de login com altura fixa */
  #loginButton {
    min-height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Efeito de bolinhas ondulares */
  .loading-dots {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  .loading-dots span {
    width: 8px;
    height: 8px;
    background-color: #fff;
    border-radius: 50%;
    animation: wave 1.2s ease-in-out infinite;
  }

  .loading-dots span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .loading-dots span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes wave {
    0%, 60%, 100% {
      transform: translateY(0);
    }
    30% {
      transform: translateY(-8px);
    }
  }
</style>
<script>
  (function() {
    var form = document.getElementById('loginForm');
    var btn = document.getElementById('loginButton');
    var originalText = btn.innerHTML;

    // Ao submeter o formulário, mostrar loading apenas se reCAPTCHA estiver marcado
    form.addEventListener('submit', function(e) {
      // Verifica se o reCAPTCHA foi preenchido
      var recaptchaResponse = document.querySelector('[name="g-recaptcha-response"]');
      if (recaptchaResponse && recaptchaResponse.value === '') {
        // reCAPTCHA não marcado - não mostra loading, deixa validação normal
        return;
      }

      // reCAPTCHA OK - mostra loading
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-dots"><span></span><span></span><span></span></span>';
    });
  })();
</script>